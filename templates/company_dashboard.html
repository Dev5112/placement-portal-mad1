{% extends "base.html" %}
{% block title %}Company Dashboard | Placement Portal{% endblock %}

{% block content %}
<div class="container mt-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Company Dashboard</h2>
        <a href="{{ url_for('main.logout') }}" class="btn btn-outline-danger">
            Logout
        </a>
    </div>

    <!-- ================= Company Info ================= -->
    <div class="card mb-4">
        <div class="card-body">
            <h4>{{ company.company_name }}</h4>

            <p class="mb-1"><strong>HR Contact:</strong> {{ company.hr_contact }}</p>
            <p class="mb-1">
                <strong>Website:</strong>
                <a href="{{ company.website }}" target="_blank">
                    {{ company.website }}
                </a>
            </p>

            <p>
                <strong>Status:</strong>
                {% if company.approval_status == "APPROVED" %}
                    <span class="badge bg-success">Approved</span>
                {% else %}
                    <span class="badge bg-warning text-dark">
                        Pending Admin Approval
                    </span>
                {% endif %}
            </p>

            {% if company.approval_status == "APPROVED" %}
                <a href="{{ url_for('main.create_drive') }}"
                   class="btn btn-primary">
                    Create Drive
                </a>
            {% endif %}
        </div>
    </div>

    <!-- ================= Upcoming Drives ================= -->
    <h4>Upcoming Drives</h4>

    {% set upcoming = drives | selectattr("status", "equalto", "APPROVED") | list %}

    {% if upcoming %}
    <table class="table table-bordered table-striped">
        <thead class="table-dark">
        <tr>
            <th>Job Title</th>
            <th>Deadline</th>
            <th>Applicants</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for drive in upcoming %}
        <tr>
            <td>{{ drive.job_title }}</td>
            <td>{{ drive.application_deadline }}</td>
            <td>{{ drive.applications | length }}</td>
            <td>
                <a href="{{ url_for('main.view_applications', id=drive.id) }}"
                   class="btn btn-sm btn-info">
                    View Applications
                </a>

                <a href="{{ url_for('main.close_drive', id=drive.id) }}"
                   class="btn btn-sm btn-warning">
                    Mark as Complete
                </a>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p>No upcoming drives.</p>
    {% endif %}

    <!-- ================= Closed Drives ================= -->
    <h4 class="mt-5">Closed Drives</h4>

    {% set closed = drives | selectattr("status", "equalto", "CLOSED") | list %}

    {% if closed %}
    <table class="table table-bordered table-striped">
        <thead class="table-dark">
        <tr>
            <th>Job Title</th>
            <th>Applicants</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        {% for drive in closed %}
        <tr>
            <td>{{ drive.job_title }}</td>
            <td>{{ drive.applications | length }}</td>
            <td>
                <a href="{{ url_for('main.view_applications', id=drive.id) }}"
                   class="btn btn-sm btn-secondary">
                    View
                </a>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p>No closed drives.</p>
    {% endif %}

</div>
{% endblock %}
