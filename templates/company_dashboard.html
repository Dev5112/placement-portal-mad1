{% extends "base.html" %}
{% block title %}Company Dashboard | Placement Portal{% endblock %}

{% block content %}
<div class="container mt-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Company Dashboard</h2>
        <a href="{{ url_for('main.logout') }}" class="btn btn-outline-danger">
            Logout
        </a>
    </div>

    <!-- ================= Company Info ================= -->
    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <h4>{{ company.company_name }}</h4>

            <p class="mb-1"><strong>HR Contact:</strong> {{ company.hr_contact }}</p>

            <p class="mb-1">
                <strong>Website:</strong>
                <a href="{{ company.website }}" target="_blank">
                    {{ company.website }}
                </a>
            </p>

            <p>
                <strong>Status:</strong>
                {% if company.approval_status == "APPROVED" %}
                    <span class="badge bg-success">Approved</span>
                {% else %}
                    <span class="badge bg-warning text-dark">
                        Pending Admin Approval
                    </span>
                {% endif %}
            </p>

            {% if company.approval_status == "APPROVED" %}
                <a href="{{ url_for('main.create_drive') }}"
                   class="btn btn-primary">
                    + Create Drive
                </a>
            {% endif %}
        </div>
    </div>

    <!-- ================= Pending Drives ================= -->
    <h4>Pending Drives</h4>

    {% set pending = drives | selectattr("status", "equalto", "PENDING") | list %}

    {% if pending %}
    <table class="table table-bordered table-striped align-middle">
        <thead class="table-dark">
        <tr>
            <th>Job Title</th>
            <th>Deadline</th>
            <th>Status</th>
            <th>Applicants</th>
        </tr>
        </thead>
        <tbody>
        {% for drive in pending %}
        <tr>
            <td>{{ drive.job_title }}</td>
            <td>{{ drive.application_deadline.strftime('%d-%m-%Y') }}</td>
            <td>
                <span class="badge bg-warning text-dark">
                    Pending Approval
                </span>
            </td>
            <td>{{ drive.applications | length }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
        <div class="alert alert-info">
            No pending drives.
        </div>
    {% endif %}


    <!-- ================= Active Drives ================= -->
    <h4 class="mt-5">Active Drives</h4>

    {% set active = drives | selectattr("status", "equalto", "APPROVED") | list %}

    {% if active %}
    <table class="table table-bordered table-striped align-middle">
        <thead class="table-dark">
        <tr>
            <th>Job Title</th>
            <th>Deadline</th>
            <th>Status</th>
            <th>Applicants</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for drive in active %}
        <tr>
            <td>{{ drive.job_title }}</td>
            <td>{{ drive.application_deadline.strftime('%d-%m-%Y') }}</td>
            <td>
                <span class="badge bg-success">Active</span>
            </td>
            <td>{{ drive.applications | length }}</td>

            <td class="d-flex flex-wrap gap-1">

                <!-- View Drive Details -->
                <a href="{{ url_for('main.view_drive', id=drive.id) }}"
                class="btn btn-sm btn-secondary">
                    View Drive
                </a>

                <!-- View Applications -->
                <a href="{{ url_for('main.view_applications', id=drive.id) }}"
                class="btn btn-sm btn-info">
                    Applications
                </a>

                <!-- Edit -->
                <a href="{{ url_for('main.edit_drive', id=drive.id) }}"
                class="btn btn-sm btn-primary">
                    Edit
                </a>

                <!-- Close -->
                <a href="{{ url_for('main.close_drive', id=drive.id) }}"
                class="btn btn-sm btn-warning"
                onclick="return confirm('Mark this drive as completed?');">
                    Close
                </a>

                <!-- Delete -->
                <a href="{{ url_for('main.delete_drive', id=drive.id) }}"
                class="btn btn-sm btn-danger"
                onclick="return confirm('Are you sure you want to delete this drive?');">
                    Delete
                </a>

            </td>

        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
        <div class="alert alert-info">
            No active drives.
        </div>
    {% endif %}


    <!-- ================= Closed Drives ================= -->
    <h4 class="mt-5">Closed Drives</h4>

    {% set closed = drives | selectattr("status", "equalto", "CLOSED") | list %}

    {% if closed %}
    <table class="table table-bordered table-striped align-middle">
        <thead class="table-dark">
        <tr>
            <th>Job Title</th>
            <th>Applicants</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        {% for drive in closed %}
        <tr>
            <td>{{ drive.job_title }}</td>
            <td>{{ drive.applications | length }}</td>
            <td>
                <span class="badge bg-secondary">Closed</span>
            </td>
            <td>
                <a href="{{ url_for('main.view_applications', id=drive.id) }}"
                   class="btn btn-sm btn-secondary">
                    View Applications
                </a>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
        <div class="alert alert-info">
            No closed drives.
        </div>
    {% endif %}

</div>
{% endblock %}
